<!DOCTYPE html>

<!-- Unit price comparison tool. Copyright Â© Paul Koepke, 2014 -->

<html manifest="unitpricecomparison.appcache">
	<head>
		<meta charset="UTF-8">
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<title>Unit Price Comparison - by Paul Koepke</title>
		<link id="styles" rel="stylesheet" type="text/css" href="styles.css">
		<link rel="icon" type="image/png" href="/favicon.png">
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

			ga('create', 'UA-29633726-1', 'paulkoepke.com');
			ga('send', 'pageview');
		</script>
	</head>
	<body>
		<div id="everythingDiv" class="everythingDiv" >
			<h3>Unit Price Comparison</h3>
			<button id="expandButton" class="expandButton">Expand cards</button>
			<button id="clearAllButton" class="clearAllButton" onclick="clearAll()">Clear all</button>
			<div id="item1CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item1FirstRowDiv">
					<input type="text" id="item1Name" class="itemName" placeholder="Item 1 name" >
					<input type="number" id="item1Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item1Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item1PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item1FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item1SecondRowDiv">
					<input type="number" id="item1quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item1UnitsName" class="unitsName" placeholder="Units name">
				</div> <!-- end item1SecondRowDiv -->
			</div><!-- end item1CardDiv -->
			<div id="item2CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item2FirstRowDiv">
					<input type="text" id="item2Name" class="itemName" placeholder="Item 2 name">
					<input type="number" id="item2Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item2Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item2PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item2FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item2SecondRowDiv">
					<input type="number" id="item2quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item2UnitsName" class="unitsName" placeholder="Unit name">
				</div> <!-- end item2SecondRowDiv -->
			</div><!-- end item2CardDiv -->
			<div id="item3CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item3FirstRowDiv">
					<input type="text" id="item3Name" class="itemName" placeholder="Item 3 name">
					<input type="number" id="item3Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item3Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item3PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item3FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item3SecondRowDiv">
					<input type="number" id="item3quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item3UnitsName" class="unitsName" placeholder="Unit name">
				</div> <!-- end item3SecondRowDiv -->
			</div><!-- end item3CardDiv -->
			<div id="item4CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item4FirstRowDiv">
					<input type="text" id="item4Name" class="itemName" placeholder="Item 4 name">
					<input type="number" id="item4Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item4Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item4PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item4FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item4SecondRowDiv">
					<input type="number" id="item4quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item4UnitsName" class="unitsName" placeholder="Unit name">
				</div> <!-- end item4SecondRowDiv -->
			</div><!-- end item4CardDiv -->
			<div id="item5CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item5FirstRowDiv">
					<input type="text" id="item5Name" class="itemName" placeholder="Item 5 name">
					<input type="number" id="item5Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item5Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item5PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item5FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item5SecondRowDiv">
					<input type="number" id="item5quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item5UnitsName" class="unitsName" placeholder="Unit name">
				</div> <!-- end item5SecondRowDiv -->
			</div><!-- end item5CardDiv -->
			<div id="item6CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item6FirstRowDiv">
					<input type="text" id="item6Name" class="itemName" placeholder="Item 6 name">
					<input type="number" id="item6Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item6Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item6PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item6FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item6SecondRowDiv">
					<input type="number" id="item6quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item6UnitsName" class="unitsName" placeholder="Unit name">
				</div> <!-- end item6SecondRowDiv -->
			</div><!-- end item6CardDiv -->
			<div id="item7CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item7FirstRowDiv">
					<input type="text" id="item7Name" class="itemName" placeholder="Item 7 name">
					<input type="number" id="item7Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item7Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item7PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item7FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item7SecondRowDiv">
					<input type="number" id="item7quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item7UnitsName" class="unitsName" placeholder="Unit name">
				</div> <!-- end item7SecondRowDiv -->
			</div><!-- end item7CardDiv -->
			<div id="item8CardDiv" class="itemCard" >
				<div class="itemFirstRowDiv" id="item8FirstRowDiv">
					<input type="text" id="item8Name" class="itemName" placeholder="Item 8 name">
					<input type="number" id="item8Price" class="price" placeholder="Price" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="number" id="item8Units" class="units" placeholder="Units" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<span id="item8PricePerUnits" class="itemPricePerUnits">$/unit</span>
				</div> <!-- end item8FirstRowDiv -->
				<div class="itemSecondRowDiv" id="item8SecondRowDiv">
					<input type="number" id="item8quantity" class="quantity" placeholder="Qty" onchange="doAllCalculations()" onkeyup="doAllCalculations()"  oncut="doAllCalculations()" onpaste="doAllCalculations()">
					<input type="text" id="item8UnitsName" class="unitsName" placeholder="Unit name">
				</div> <!-- end item8SecondRowDiv -->
			</div><!-- end item8CardDiv -->
		</div> <!-- end everythingDiv -->
		<script>
			function doAllCalculations() {
				var allDataObject = {
					price: [],
					units: [],
					quantity: [],
					pricePerUnit: []
				}
				getAllPriceUnitQuantity(allDataObject, 'price');
				getAllPriceUnitQuantity(allDataObject, 'units');
				getAllPriceUnitQuantity(allDataObject, 'quantity');
				calculateAllPricesPerUnit(allDataObject);
				displayAllPricesPerUnit(allDataObject);
			}

			function getAllPriceUnitQuantity(allDataObject, currentField) {
				var nodeList = document.getElementsByClassName(currentField); // create NodeList object of all nodes of the current Class.
				nodeList = Array.prototype.slice.call(nodeList); // convert NodeList to an Array for easier functional iterating. From https://developer.mozilla.org/en-US/docs/Web/API/NodeList
				nodeList.forEach( function(currentNode, index) {
					if(currentNode.value === '' || Number.isNaN(currentNode.value)) { // if the value of the current item is blank or NaN
						allDataObject[currentField][index] = NaN;
					} else {
						allDataObject[currentField][index] = Number(currentNode.value);
					}
				}); // iterate over the nodeList array and get the values from each item.
			}

			function calculateAllPricesPerUnit(allDataObject) {
				allDataObject.price.forEach( function (currentItem, index) {
					if(Number.isNaN(allDataObject.quantity[index])) { // if quantity of current item is NaN, use 1 as the quantity. Typically this will happen when the user doesn't enter any quantity.
						var currentQuantity = 1;
					} else {
						var currentQuantity = allDataObject.quantity[index];
					}
					if(!Number.isNaN(allDataObject.price[index]) && !Number.isNaN(allDataObject.units[index])) { // if price and units aren't NaN, run the calculation.
						allDataObject.pricePerUnit[index] = allDataObject.price[index] / (allDataObject.units[index] * currentQuantity);
					} else { // if either price or units are NaN, set pricePerUnit to NaN. If the user deletes a number then the price per unit should be NaN and blanked out.
						allDataObject.pricePerUnit[index] = NaN;
					}
				});
			}

			function displayAllPricesPerUnit(allDataObject) {
				var nodeList = document.getElementsByClassName('itemPricePerUnits'); // create NodeList object of all nodes of this Class.
				nodeList = Array.prototype.slice.call(nodeList); // convert NodeList to an Array for easier functional iterating. From https://developer.mozilla.org/en-US/docs/Web/API/NodeList
				nodeList.forEach( function (currentNode, index){
					if(isNaN(allDataObject.pricePerUnit[index])) { // if the current pricePerUnit is NaN, revert the span to the starting HTML.
						currentNode.innerHTML = '$/unit';
					} else {
						currentNode.innerHTML = '$' + Math.round(allDataObject.pricePerUnit[index] * 1000) / 1000;
					}
				});
			}

			function clearAll() {
				var allInputs = document.getElementsByTagName('input');
				allInputs = Array.prototype.slice.call(allInputs); // convert NodeList to an Array for easier functional iterating. From https://developer.mozilla.org/en-US/docs/Web/API/NodeList
				allInputs.forEach(function(currentNode) {
					currentNode.value = '';
				});
				doAllCalculations(); // Resets all of the unit price fields.
			}

			function localizeCurrency() {

			}

		</script>
	</body>
</html>
